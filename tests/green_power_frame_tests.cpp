#include <iostream>
#include <iomanip>
#include <vector>
#include <array>

#include "spi/ByteBuffer.h"
#include "ezsp/zbmessage/green-power-frame.h"
#include "TestHarness.h"

TEST_GROUP(green_power_frame_tests) {
};

TEST(green_power_frame_tests, mic_calculation) {
	NSSPI::ByteBuffer ezspMsg({0x00, 0xde, 0xad, 0x00, 0x0a, 0x00, 0x54, 0x00, 0x0a, 0x00, 0x54, 0x00, 0xc5, 0x02, 0x04, 0x00, 0x01, 0xad, 0x10, 0x00, 0x00, 0xa2, 0xb5, 0x92, 0x23, 0x4e, 0x00, 0x11, 0x01, 0x00, 0x20, 0x00, 0x20, 0x20, 0x00, 0x00, 0x00, 0x40, 0x42, 0x05, 0x31, 0x2e, 0x30, 0x2e, 0x30});
	NSEZSP::CGpFrame gpf(ezspMsg);
	if (!gpf.validateMIC({0xAC, 0xF2, 0x03, 0x6F, 0x55, 0x82, 0x72, 0x08, 0x5A, 0x30, 0xB0, 0x6D, 0x60, 0x36, 0x83, 0x5F})) {
		FAILF("Re-caclulated MIC does not match the one enclosed in the GP frame");
	}
	NOTIFYPASS();
}


#ifndef USE_CPPUTEST
void unit_tests_green_power_frame() {
	mic_calculation();
}
#endif	// USE_CPPUTEST
